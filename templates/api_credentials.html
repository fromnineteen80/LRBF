{% extends "base.html" %}
{% block title %}API Credentials - Railyard Markets{% endblock %}
{% block page_title %}API Credentials{% endblock %}
{% block content %}
<div class="card">
    <div class="card-header"><h3 class="card-title">API Configuration</h3></div>
    <div class="card-content">
        <div class="grid grid-cols-1 gap-4">
            <div>
                <h4 class="title-medium mb-2">Interactive Brokers (IBKR)</h4>
                <p class="body-medium" id="ibkrStatus">Status: <span class="label-medium">Not Configured</span></p>
                <button class="button button-outlined mt-2" onclick="testService('ibkr')">Test Connection</button>
            </div>
            <div>
                <h4 class="title-medium mb-2">Capitalise.ai</h4>
                <p class="body-medium" id="capitaliseStatus">Status: <span class="label-medium">Configured</span></p>
                <button class="button button-outlined mt-2" onclick="testService('capitalise')">Test Connection</button>
            </div>
            <div>
                <h4 class="title-medium mb-2">Market Data</h4>
                <p class="body-medium" id="yfinanceStatus">Status: <span class="label-medium">Simulation Mode</span></p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>
async function testService(service) {
    try {
        const data = await apiCall(`/api/credentials/test/${service}`, {method: 'POST'});
        showSnackbar(`${service} connection successful`);
    } catch (error) {
        showSnackbar(`${service} connection failed`);
    }
}

async function loadCredentials() {
    try {
        const data = await apiCall('/api/credentials/get');
        document.getElementById('ibkrStatus').querySelector('span').textContent = data.ibkr_configured ? 'Configured' : 'Not Configured';
        document.getElementById('capitaliseStatus').querySelector('span').textContent = data.capitalise_configured ? 'Configured' : 'Not Configured';
        document.getElementById('yfinanceStatus').querySelector('span').textContent = data.yfinance_status;
    } catch (error) {
        console.error('Failed to load credentials:', error);
    }
}
loadCredentials();
</script>
{% endblock %}
