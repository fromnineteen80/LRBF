{% extends "base.html" %}
{% block title %}History - Railyard Markets{% endblock %}
{% block page_title %}Trading History{% endblock %}
{% block content %}
<md-elevated-card>
    <div style="padding: 16px; border-bottom: 1px solid var(--md-sys-color-outline-variant);">
        <div style="display: flex; align-items: center; gap: 12px;">
            <md-icon style="color: var(--md-sys-color-primary);">history</md-icon>
            <h3 class="card-title" style="margin: 0;">Performance History</h3>
        </div>
    </div>
    <div style="padding: 24px;">
        <div id="loadingChart" style="text-align: center; padding: 40px;">
            <md-circular-progress indeterminate></md-circular-progress>
            <p class="body-medium" style="margin-top: 16px; color: var(--md-sys-color-on-surface-variant);">Loading historical data...</p>
        </div>
        <div id="chartContainer" style="display: none;">
            <canvas id="historyChart" height="100"></canvas>
        </div>
    </div>
</md-elevated-card>
{% endblock %}
{% block scripts %}
<script>
async function loadHistory() {
    try {
        const data = await apiCall('/api/history/range?days=30');
        
        // Hide loading, show chart
        document.getElementById('loadingChart').style.display = 'none';
        document.getElementById('chartContainer').style.display = 'block';
        
        const ctx = document.getElementById('historyChart');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.history.map(d => new Date(d.date).toLocaleDateString()),
                datasets: [{
                    label: 'Daily P&L', 
                    data: data.history.map(d => d.realized_pl), 
                    borderColor: 'rgb(var(--md-sys-color-primary-rgb, 25, 118, 210))',
                    backgroundColor: 'rgba(var(--md-sys-color-primary-rgb, 25, 118, 210), 0.1)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true, 
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        labels: {
                            font: { family: 'Roboto, sans-serif' }
                        }
                    }
                }
            }
        });
    } catch (error) {
        console.error('Failed to load history:', error);
        document.getElementById('loadingChart').innerHTML = `
            <div style="text-align: center; padding: 40px;">
                <md-icon style="color: var(--md-sys-color-error); font-size: 48px;">error</md-icon>
                <p class="body-medium" style="margin-top: 16px; color: var(--md-sys-color-error);">Failed to load history</p>
            </div>
        `;
    }
}
loadHistory();
</script>
{% endblock %}
